---
title: "Public API"
author: "by [Yan Holtz](https://github.com/holtzy/) - `r format(Sys.time(), '%d %B %Y')`"
---

<br><br>





> Recover price of public API

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rmarkdown)    # You need this library to run this template.
library(epuRate)      # Install with devtools: install_github("holtzy/epuRate", force=TRUE)
library(DT)
```







#- Call a platform API with an URL
***
Let's say you want to harvest the Bitcoin in the Kraken plateform. You have to call it's public API. You can do that in your browser, typing this URL:  
[https://api.kraken.com/0/public/Ticker?pair=BTCEUR]()

Description of the result.





#- Call the API in command line
Now let's do the same using the R programming language:

```{r, warning=FALSE, message=FALSE, eval=FALSE}
# Recover the information
library(RCurl)
adress <- "https://api.kraken.com/0/public/Ticker?pair=BTCEUR"
ticker <- getURLContent(adress)

# Make the format more readable
require(jsonlite)
tmp <- fromJSON(ticker)$result[[1]]
result = data.frame(ask=tmp$a[1], bid=tmp$b[1], last=tmp$c[1], open=tmp$o, low=tmp$l[1], high=tmp$h[1], volume=tmp$v[1], volumeQuote=NA, timestamp=NA)
#datatable(result, rownames = FALSE, options = list(dom=TRUE) )
result
```

We can transform this piece of code in a function.
```{r}
get_kraken=function(time, currency){
  adress=paste("https://api.kraken.com/0/public/Ticker?pair=", currency, sep="" )
  tmp=getURLContent(adress) %>% fromJSON() 
  tmp=tmp$result[[1]]
  result = data.frame(time=time, platform="Kraken", ask=tmp$a[1], bid=tmp$b[1], last=tmp$c[1], open=tmp$o, low=tmp$l[1], high=tmp$h[1], volume=tmp$v[1], volumeQuote=NA, timestamp=NA, symbol=currency)
  return(result)
}
```





#- Access to several plateform
Link to the public_API functions.
Give a few example



#- Harvest 5 plateforms for 5 currencies {.tabset .tabset-fade .tabset-pills}
***
I've created a text file with one function like the one above per plateform. The file is located in my [github](https://github.com/holtzy/Cryp-To/blob/master/FUNCTIONS/Public_Market_Functions.R). We can source it doing:

```{r, warning=FALSE, message=FALSE}
# POTENTIAL PROBLEM WITH THE LOADING OF LIBRARIES
source("https://raw.githubusercontent.com/holtzy/Cryp-To/master/FUNCTIONS/Public_Market_Functions.R")
```


Now we are ready for an infinite loop! I'm gonna run these functions for several platforms and several crypto every 10 secondes approx.
```{r, eval=FALSE}
#Initialize an emtpy result table
Ticker=as.data.frame(matrix(NA, 0, 12))
names(Ticker) = c("time", "platform", "ask", "bid", "last", "open", "low", "high", "volume", "volumeQuote", "timestamp", "symbol")

# Run the analysis
num=0
while(TRUE){
  
  # Keep a trace of where we are in this loop
  num=num+1
  cat("Let's start the iteration number: ",num, " at ", Sys.time(), "\n" )
  
  # BITCOIN (BTC)
  time=Sys.time()
  tmp=try(get_coinbase(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitfinex(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # ETHERUM (ETH)
  time=Sys.time()
  tmp=try(get_coinbase(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # LITECOIN (LTC)
  time=Sys.time()
  tmp=try(get_coinbase(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }

  # BITCOINCASH (BCH)
  time=Sys.time()
  tmp=try(get_coinbase(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # RIPPLE (XRP)
  time=Sys.time()
  tmp=try(get_kraken(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }

  # Every ten loop I save the file
  if (num %% 1 == 0){  save(Ticker, file="../DATA/public_ticker_harvest.Rdata")  }

}
```

I've run this script during X days from the to the. This dataset is called `public_ticker_harvest.Rdata` that is available [on github](https://github.com/holtzy/Cryp-To/tree/master/DATA).

Link to the final dataset

Show a graphic for one crypto.









