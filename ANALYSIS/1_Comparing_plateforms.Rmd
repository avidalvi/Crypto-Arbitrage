---
title: "Comparing Crypto currency platforms"
author: "by [Yan Holtz](https://github.com/holtzy/) - `r format(Sys.time(), '%d %B %Y')`"
output:
  epuRate::epurate:
    toc: FALSE
    code_folding: "show"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
  
```{r echo=FALSE}
# Just to add space between the introduction of the document
knitr::asis_output(htmltools::htmlPreserve("<br><br>"))
```


> Crypto currencies are quite trendy those days. Definition. You can buy some in every places. But is the price the same everywhere?

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(rmarkdown)    # You need this library to run this template.
library(epuRate)      # Install with devtools: install_github("holtzy/epuRate", force=TRUE)
```




# Call a platform API
***
Let's say you want to harvest the Bitcoin in the Kraken plateform. You have to call it's public API. You can do that in your browser, typing this URL:  
[https://api.kraken.com/0/public/Ticker?pair=BTCEUR]()

Description of the result.

Now let's do the same using the R programming language:

```{r, warning=FALSE, message=FALSE}
# Recover the information
library(RCurl)
adress <- "https://api.kraken.com/0/public/Ticker?pair=BTCEUR"
ticker <- getURLContent(adress)

# Make the format more readable
require(jsonlite)
tmp <- fromJSON(ticker)$result[[1]]
result = data.frame(ask=tmp$a[1], bid=tmp$b[1], last=tmp$c[1], open=tmp$o, low=tmp$l[1], high=tmp$h[1], volume=tmp$v[1], volumeQuote=NA, timestamp=NA)
result
```

We can transform this piece of code in a function.
```{r}
get_kraken=function(time, currency){
  adress=paste("https://api.kraken.com/0/public/Ticker?pair=", currency, sep="" )
  tmp=getURLContent(adress) %>% fromJSON() 
  tmp=tmp$result[[1]]
  result = data.frame(time=time, platform="Kraken", ask=tmp$a[1], bid=tmp$b[1], last=tmp$c[1], open=tmp$o, low=tmp$l[1], high=tmp$h[1], volume=tmp$v[1], volumeQuote=NA, timestamp=NA, symbol=currency)
  return(result)
}
```







# Harvest x plateforms for X currencies {.tabset .tabset-fade .tabset-pills}
***
I've created a text file with one function like the one above per plateform. The file is located in my [github](https://github.com/holtzy/Cryp-To/blob/master/FUNCTIONS/Public_Market_Functions.R). We can source it doing:

```{r, warning=FALSE, message=FALSE}

# POTENTIAL PROBLEM WITH THE LOADING OF LIBRARIES
source("https://raw.githubusercontent.com/holtzy/Cryp-To/master/FUNCTIONS/Public_Market_Functions.R")
```


Now we are ready for an infinite loop! I'm gonna run these functions for several platforms and several crypto every 10 secondes approx.
```{r, EVAL=FALSE}
#Initialize an emtpy result table
Ticker=as.data.frame(matrix(NA, 0, 12))
names(Ticker) = c("time", "platform", "ask", "bid", "last", "open", "low", "high", "volume", "volumeQuote", "timestamp", "symbol")

# Run the analysis
num=0
while(TRUE){
  
  # Keep a trace of where we are in this loop
  num=num+1
  cat("Let's start the iteration number: ",num, " at ", Sys.time() )
  
  # BITCOIN
  time=Sys.time()
  tmp=try(get_coinbase(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitfinex(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "BTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # ETHERUM
  time=Sys.time()
  tmp=try(get_coinbase(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitfinex(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "ETHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # LITECOIN
  time=Sys.time()
  tmp=try(get_coinbase(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "LTCEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }

  # BITCOINCASH
  time=Sys.time()
  tmp=try(get_coinbase(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_kraken(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "BCHEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  
  # RIPPLE (XRP)
  time=Sys.time()
  tmp=try(get_kraken(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_bitstamp(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }
  tmp=try(get_cex(time, "XRPEUR")) ; if(is.data.frame(tmp)){ Ticker=rbind(Ticker, tmp) }

  # Every ten loop I save the file
  if (num %% 10 == 0){  save(Ticker, file="../DATA/public_ticker_harvest.Rdata")  }

}
```




















